name: 🚀 Release Clavier Créole

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Version à publier (ex: v3.1.0)'
        required: true
        default: 'v3.1.0'

jobs:
  create-release:
    name: 📦 Create GitHub Release
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout Repository
      uses: actions/checkout@v4
      
    - name: ☕ Setup JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: 📱 Grant Execute Permission for Gradlew
      run: chmod +x android_keyboard/gradlew
      
    - name: � Verify Project Structure
      run: |
        echo "📂 Project structure verification:"
        ls -la android_keyboard/
        echo "📱 Gradle wrapper check:"
        ls -la android_keyboard/gradlew*
      
    - name: 🔨 Build Release APK
      working-directory: android_keyboard
      run: ./gradlew assembleRelease
        
    - name: 📝 Extract Release Notes
      id: extract_notes
      run: |
        VERSION=${{ github.event.inputs.version || github.ref_name }}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        
        # Générer les notes de version automatiquement
        cat > release_notes.md << EOF
        # 🇬🇵 Clavier Créole Guadeloupéen $VERSION
        
        ## 🌟 Nouveautés
        
        ### ⌨️ Layout AZERTY Créole Optimisé
        - Layout intégré : \`azertyuiopàé\` / \`qsdfghjklmò\` / \`wxcvbnè\`
        - Accès direct aux caractères créoles essentiels
        - Interface compacte et ergonomique
        
        ### 🎯 Fonctionnalités
        - ✅ **1 867 mots créoles** dans le dictionnaire
        - ✅ **Suggestions intelligentes** en temps réel
        - ✅ **Accents créoles** intégrés au layout
        - ✅ **Mode numérique** avec basculement fluide
        - ✅ **Design Guadeloupéen** avec couleurs tropicales
        
        ### 🔧 Améliorations Techniques
        - Performance optimisée pour Android 7.0+
        - Interface InputMethodService native
        - Gestion avancée des majuscules/minuscules
        - Appuis longs pour accents additionnels
        
        ## 📱 Installation
        
        1. Télécharger l'APK ci-dessous
        2. Autoriser l'installation d'applications tierces
        3. Installer \`Potomitan_Kreyol_Keyboard_$VERSION.apk\`
        4. Activer le clavier dans Paramètres > Langues et saisie
        
        ## 🏝️ À propos
        
        **Potomitan™** - Clavier intelligent pour la saisie en **Kreyòl Guadeloupéen**
        
        Développé avec ❤️ pour préserver et promouvoir la langue créole guadeloupéenne.
        EOF
        
    - name: 🏷️ Create Release
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ steps.extract_notes.outputs.version }}
        name: "🇬🇵 Clavier Créole Guadeloupéen ${{ steps.extract_notes.outputs.version }}"
        bodyFile: release_notes.md
        artifacts: "android_keyboard/app/build/outputs/apk/release/*.apk"
        draft: false
        prerelease: false
        generateReleaseNotes: true
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: 📢 Release Success
      run: |
        echo "🎉 ✅ RELEASE CRÉÉE AVEC SUCCÈS !"
        echo "🇬🇵 Clavier Créole Guadeloupéen ${{ steps.extract_notes.outputs.version }}"
        echo "📱 APK disponible dans la release GitHub"
        echo "🔗 https://github.com/${{ github.repository }}/releases/tag/${{ steps.extract_notes.outputs.version }}"