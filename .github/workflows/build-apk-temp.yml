name: ðŸ—ï¸ Build Potomitan Kreyol Keyboard APK

on:
  push:
    branches: [ main ]
    paths:
      - 'android_keyboard/**'
      - '.github/workflows/**'
    tags:
      - 'v*'
  pull_request:
    branches: [ main ]
    paths:
      - 'android_keyboard/**'
  workflow_dispatch:

jobs:
  build:
    name: ðŸ“± Build Samsung-Compatible APK
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: â˜• Setup JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ðŸ˜ Setup Gradle
      uses: gradle/gradle-build-action@v2
      with:
        gradle-version: wrapper
        
    - name: ðŸ“„ Make Gradlew Executable
      run: chmod +x android_keyboard/gradlew
      
    - name: ðŸ§¹ Clean Project
      run: |
        cd android_keyboard
        ./gradlew app:clean

    - name: ðŸ”¨ Build Debug APK (Samsung Compatible)
      run: |
        cd android_keyboard
        ./gradlew assembleDebug
        
    - name: ðŸ”¨ Build Release APK (Samsung Compatible)
      run: |
        cd android_keyboard
        ./gradlew assembleRelease
        
    - name: ðŸ“ List Built APKs
      run: |
        echo "ðŸŽ¯ APK Files Built:"
        find android_keyboard/app/build/outputs/apk -name "*.apk" -exec ls -la {} \;
        
    - name: ðŸ“¤ Upload Debug APK
      uses: actions/upload-artifact@v4
      with:
        name: ðŸ“± Potomitan-Kreyol-Keyboard-DEBUG-Samsung
        path: android_keyboard/app/build/outputs/apk/debug/*.apk
        retention-days: 30
        
    - name: ðŸ“¤ Upload Release APK  
      uses: actions/upload-artifact@v4
      with:
        name: ðŸ“± Potomitan-Kreyol-Keyboard-RELEASE-Samsung
        path: android_keyboard/app/build/outputs/apk/release/*.apk
        retention-days: 90
        
    - name: ðŸ“Š APK Info
      run: |
        echo "ðŸŽ‰ Build completed successfully!"
        echo ""
        echo "ðŸ“± Debug APK (Easy Installation):"
        ls -la android_keyboard/app/build/outputs/apk/debug/*.apk
        echo ""
        echo "ðŸ“± Release APK (Production):"
        ls -la android_keyboard/app/build/outputs/apk/release/*.apk
        echo ""
        echo "ðŸ”— Download APKs from GitHub Actions Artifacts section"
        echo "ðŸ’¡ For Samsung tablets: Try DEBUG version first (easier to install)"
        
  release:
    name: ðŸš€ Create GitHub Release
    runs-on: ubuntu-latest
    needs: build
    if: startsWith(github.ref, 'refs/tags/v')
    
    steps:
    - name: ðŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ðŸ“¥ Download Debug APK
      uses: actions/download-artifact@v4
      with:
        name: ðŸ“± Potomitan-Kreyol-Keyboard-DEBUG-Samsung
        path: ./apk-debug/
        
    - name: ðŸ“¥ Download Release APK
      uses: actions/download-artifact@v4
      with:
        name: ðŸ“± Potomitan-Kreyol-Keyboard-RELEASE-Samsung
        path: ./apk-release/
        
    - name: ðŸš€ Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          ./apk-debug/*.apk
          ./apk-release/*.apk
        name: Potomitan Kreyol Keyboard ${{ github.ref_name }}
        body: |
          ## ðŸ“± Potomitan Kreyol Keyboard ${{ github.ref_name }}
          
          ### ðŸ”¥ Highlights
          - âœ… Samsung Ultra-Compatible APKs
          - âœ… Enhanced multi-source suggestions ("sou" â†’ "soudÃ©")
          - âœ… Real-time contextual predictions
          - âœ… Full Creole dictionary + N-grams support
          
          ### ðŸ“‹ Installation Instructions
          
          **ðŸŽ¯ For Samsung Tablets (Recommended)**:
          1. Download **DEBUG APK** (easier to install)
          2. Enable "Unknown Sources" in Settings â†’ Security
          3. Install APK through "My Files" app
          
          **ðŸ“± APK Variants**:
          - **DEBUG**: `Potomitan_Kreyol_Keyboard_v1.2-Samsung_debug_*.apk` (Recommended for Samsung)
          - **RELEASE**: `Potomitan_Kreyol_Keyboard_v1.2-Samsung_release_*.apk` (Production)
          
          ### ðŸ› ï¸ Technical Details
          - **ApplicationId**: `com.potomitan.kreyolkeyboard`
          - **Target SDK**: 33 (Samsung optimized)  
          - **Architectures**: arm64-v8a, armeabi-v7a
          - **Samsung Compatibility**: Ultra-optimized
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
